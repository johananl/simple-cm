version: '3.3'
services:
  host1:
    image: arvindr226/alpine-ssh
    ports:
      - "22"
  host2:
    image: arvindr226/alpine-ssh
    ports:
      - "22"
  host3:
    image: arvindr226/alpine-ssh
    ports:
      - "22"
  host4:
    image: arvindr226/alpine-ssh
    ports:
      - "22"
  host5:
    image: arvindr226/alpine-ssh
    ports:
      - "22"
  db:
    image: cassandra
    ports:
      - "9042:9042"
  worker1:
    build:
      context: .
      dockerfile: ./docker/worker/Dockerfile
    ports:
      - "8888"
  worker2:
    build:
      context: .
      dockerfile: ./docker/worker/Dockerfile
    ports:
      - "8888"
  worker3:
    build:
      context: .
      dockerfile: ./docker/worker/Dockerfile
    ports:
      - "8888"
  master:
    depends_on:
      - host1
      - host2
      - host3
      - host4
      - host5
      - db
      - worker1
      - worker2
      - worker3
    build:
      context: .
      dockerfile: ./docker/master/Dockerfile
    command: /wait-for.sh db:9042 -- /master --db-hosts db --workers worker1:8888,worker2:8888,worker3:8888
    volumes:
      - ./ssh_keys:/etc/simple-cm/keys